<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TEST FOR API</title>
</head>
<body>
  <h1>Risk API Test</h1>
  <button id="send">Send Test Request</button>
  <!-- Displays JSON results from the API -->
  <pre id="out"></pre>

  <!-- Client-side JavaScript -->
  <script>
    /**
     * ======================================================
     * LOCAL TESTING THINGS I NEED TO REMEMBER
     * ======================================================
     * 1. Run your server locally with:  node server.js
     * 2. Visit this page via Live Server (e.g., http://localhost:5500/public/index.html)
     * 3. The script below will automatically switch between:
     *     - Local API  â†’ http://localhost:4000 or 3000
     *     - Live Azure API â†’ https://risk-calculator-api-d6dea9a7ehcxc2fw.canadacentral-01.azurewebsites.net
     * 4. Press the "Send Test Request" button to verify connectivity.
     * 5. Check console + <pre> output for your live JSON response.
     * ======================================================
     */

    // Dynamically determine API base URL for local vs. deployed testing
    const API_BASE = window.location.hostname.includes('localhost')
      ? 'http://localhost:3000'
      : 'https://risk-calculator-api-d6dea9a7ehcxc2fw.canadacentral-01.azurewebsites.net';

    // Finds button by id 'send'
    document.getElementById('send').onclick = async () => {
      try {
        console.log(`ðŸ”— Sending request to: ${API_BASE}/api/calculate-risk`);

        const res = await fetch(`${API_BASE}/api/calculate-risk`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            age: 30,
            heightFt: 5,
            heightIn: 8,
            weight: 160,
            systolic: 125,
            diastolic: 82,
            familyHistory: ['diabetes']
          })
        });

        if (!res.ok) {
          const text = await res.text().catch(() => '');
          throw new Error(`HTTP ${res.status} ${res.statusText} â€” ${text}`);
        }

        const data = await res.json();
        console.log('Response:', data);
        document.getElementById('out').textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        console.error('API call failed:', err);
        document.getElementById('out').textContent = `Error: ${err.message}`;
      }
    };
  </script>
</body>
</html>